#!/bin/sh
# Copyright (c) 2016, Vivint
#
# Update the zwave firmware on boot

zwave_program ()
{
    # if in fcc test mode use a different fw file
    if [ -f /etc/procman.d/test_ui ]; then
        path=/lib/firmware/vivint/micro_rf_linkX_ZW050x_ALL.hex
        if [ ! -e /opt/2gig/zwaved/scripts/zwave_program.pyc ]; then
            echo "ERROR: Zwave programmer not found"
            return 1
        fi

        python3 /opt/2gig/zwaved/scripts/zwave_program.pyc $path
    fi

    echo "Zwave firmware will be flashed by zwaved"
}

stop() {
    return 0
}

case "$1" in
    start|restart|reload)
    zwave_program
    ;;
    stop)
    stop
    ;;
    *)
    echo "Usage: $0 {start|stop|restart}"
    exit 1
esac

exit $?
