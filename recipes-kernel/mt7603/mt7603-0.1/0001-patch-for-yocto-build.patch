From 7b0d519b32478e8426698c26423f657d6fda0325 Mon Sep 17 00:00:00 2001
From: John Rigby <john.rigby@vivint.com>
Date: Fri, 16 Oct 2015 14:59:48 -0600
Subject: [PATCH] patch for yocto build

---
 Makefile            |   8 +++++++-
 os/linux/Makefile.6 |   4 +---
 os/linux/config.mk  |   6 +++++-
 4 files changed, 13 insertions(+), 5 deletions(-)
 delete mode 100755 tools/bin2h

diff --git a/Makefile b/Makefile
index 7cec981..28ee391 100644
--- a/Makefile
+++ b/Makefile
@@ -39,7 +39,8 @@ include $(RT28xx_DIR)/os/linux/config.mk
 RTMP_SRC_DIR = $(RT28xx_DIR)/RT$(MODULE)
 
 #PLATFORM: Target platform
-PLATFORM = PC
+#PLATFORM = PC
+PLATFORM = MX6
 #PLATFORM = MT53XX
 #PLATFORM = PC_AUTO_BUILD
 #PLATFORM = BB_SOC
@@ -222,6 +223,11 @@ LINUX_SRC_MODULE = /lib/modules/$(shell uname -r)/kernel/drivers/net/wireless/
 CROSS_COMPILE = 
 endif
 
+ifeq ($(PLATFORM),MX6)
+LINUX_SRC = /home/jcrigby/work/i.mx6/linux-imx
+CROSS_COMPILE = /opt/slimline/1.7/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-
+endif
+
 ifeq ($(PLATFORM),INTELP6)
 LINUX_SRC = /tftpboot/IntelCE-20.0.11052.243193/project_build_i686/IntelCE/kernel-20.0.11024.238456/linux-2.6.35
 CROSS_COMPILE = /tftpboot/IntelCE-20.0.11052.243193/build_i686/i686-linux-elf/bin/i686-cm-linux-
diff --git a/os/linux/Makefile.6 b/os/linux/Makefile.6
index f8a0d9b..0a946b4 100644
--- a/os/linux/Makefile.6
+++ b/os/linux/Makefile.6
@@ -764,12 +764,10 @@ endif
 
 install:
 	rm -rf $(DAT_PATH)
-	$(shell [ ! -f /etc/Wireless ] && mkdir /etc/Wireless)
-	mkdir $(DAT_PATH)
+	mkdir -p $(DAT_PATH)
 	cp $(RT28xx_DIR)/$(DAT_FILE_NAME) $(DAT_PATH)/.
 	install -d $(LINUX_SRC_MODULE)
 	install -m 644 -c $(addsuffix .ko,$(MOD_NAME)) $(LINUX_SRC_MODULE)
-	/sbin/depmod -a ${shell uname -r}
 
 uninstall:
 #	rm -rf $(DAT_PATH)
diff --git a/os/linux/config.mk b/os/linux/config.mk
index da80cce..1ee12db 100644
--- a/os/linux/config.mk
+++ b/os/linux/config.mk
@@ -345,7 +345,7 @@ endif
 CC := $(CROSS_COMPILE)gcc
 LD := $(CROSS_COMPILE)ld
 
-WFLAGS := -Wall -Wstrict-prototypes -Wno-trigraphs
+WFLAGS := -w -Wall -Wstrict-prototypes -Wno-trigraphs
 WFLAGS += -DAGGREGATION_SUPPORT -DPIGGYBACK_SUPPORT -DWMM_SUPPORT  -DLINUX -DENHANCED_STAT_DISPLAY
 WFLAGS += -DSYSTEM_LOG_SUPPORT -DRT28xx_MODE=$(RT28xx_MODE) -DCHIPSET=$(MODULE) -DRESOURCE_PRE_ALLOC 
 #WFLAGS += -DDBG_DIAGNOSE -DDBG_RX_MCS -DDBG_TX_MCS
@@ -1981,3 +1981,7 @@ endif
 ifeq ($(PLATFORM),MT7628)
         EXTRA_CFLAGS := $(WFLAGS)
 endif
+
+ifeq ($(PLATFORM),MX6)
+        EXTRA_CFLAGS := $(WFLAGS)
+endif
-- 
1.8.5.1+fc2

