From 569591320a19184a77bf2bdc390e7c8069c3891d Mon Sep 17 00:00:00 2001
From: Tanner Oakes <tanner.oakes@vivint.com>
Date: Wed, 1 Sep 2021 10:00:40 -0600
Subject: [PATCH 1/5] Log gst messages inside of qt

---
 src/gsttools/qgstutils.cpp | 43 ++++++++++++++++++++++++++++++++++++++
 1 file changed, 43 insertions(+)

diff --git a/src/gsttools/qgstutils.cpp b/src/gsttools/qgstutils.cpp
index 3f68244ba..ab550cbfa 100644
--- a/src/gsttools/qgstutils.cpp
+++ b/src/gsttools/qgstutils.cpp
@@ -69,6 +69,47 @@ template<typename T, int N> static int lengthOf(const T (&)[N]) { return N; }
 QT_BEGIN_NAMESPACE
 
 //internal
+static void qt_extension_log_func (GstDebugCategory * category,
+    GstDebugLevel level, const gchar * file, const gchar * function,
+    gint line, GObject * object, GstDebugMessage * message, gpointer unused)
+{
+  const gchar *dbg_msg;
+  gint pid;
+  gchar *obj = NULL;
+
+  if (level > gst_debug_category_get_threshold(category))
+    return;
+
+  pid = getpid();
+
+  //if (object) {
+  //  obj = gst_debug_print_object (object);
+  //} else {
+    obj = g_strdup ("");
+  //}
+
+  dbg_msg = gst_debug_message_get (message);
+  //fail_unless (dbg_msg != NULL);
+
+  switch (level) {
+    case GST_LEVEL_INFO:
+    case GST_LEVEL_LOG:
+    case GST_LEVEL_DEBUG:
+      qDebug() << "GSTREAMER: " << pid << " " << g_thread_self() << " " << gst_debug_category_get_name(category) << " " << file << ":" << line <<" " << function << " " << obj << " "<< dbg_msg;
+      break;
+    case GST_LEVEL_WARNING:
+      qWarning()  << "GSTREAMER: " << pid << " " << g_thread_self() << " " << gst_debug_category_get_name(category) << " " << file << ":" << line <<" " << function << " " << obj << " "<< dbg_msg;
+      break;
+    case GST_LEVEL_ERROR:
+      qCritical("GSTREAMER: %d %s %s:%d %s %s %s",pid,gst_debug_category_get_name(category),file,line,function,obj,dbg_msg);
+      break;
+    default:
+      qCritical("GSTREAMER(%d): %d %s %s:%d %s %s %s",level,pid,gst_debug_category_get_name(category),file,line,function,obj,dbg_msg);
+  }
+
+  g_free(obj);
+}
+
 static void addTagToMap(const GstTagList *list,
                         const gchar *tag,
                         gpointer user_data)
@@ -471,6 +512,8 @@ void QGstUtils::initializeGst()
     if (!initialized) {
         initialized = true;
         gst_init(nullptr, nullptr);
+	gst_debug_remove_log_function (gst_debug_log_default);
+	gst_debug_add_log_function (qt_extension_log_func, NULL,NULL);
     }
 }
 
-- 
2.33.0

